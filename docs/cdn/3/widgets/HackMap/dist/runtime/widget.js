System.register(["jimu-core","esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/widgets/LayerList","esri/widgets/Locate","esri/rest/route","esri/Graphic","esri/rest/support/FeatureSet","esri/rest/support/ServiceAreaParameters","esri/rest/serviceArea","esri/rest/support/RouteParameters","jimu-ui"],(function(e,t){var o={},s={},i={},r={},a={},n={},l={},d={},u={},p={},c={},m={},h={};return{setters:[function(e){o.React=e.React,o.jsx=e.jsx},function(e){s.default=e.default},function(e){i.default=e.default},function(e){r.default=e.default},function(e){a.default=e.default},function(e){n.default=e.default},function(e){l.default=e.default},function(e){d.default=e.default},function(e){u.default=e.default},function(e){p.default=e.default},function(e){c.default=e.default},function(e){m.default=e.default},function(e){h.Button=e.Button,h.Modal=e.Modal,h.ModalBody=e.ModalBody,h.ModalFooter=e.ModalFooter,h.ModalHeader=e.ModalHeader}],execute:function(){e((()=>{var e={282:e=>{"use strict";e.exports=d},254:e=>{"use strict";e.exports=s},37:e=>{"use strict";e.exports=r},820:e=>{"use strict";e.exports=l},632:e=>{"use strict";e.exports=c},903:e=>{"use strict";e.exports=u},440:e=>{"use strict";e.exports=m},836:e=>{"use strict";e.exports=p},591:e=>{"use strict";e.exports=i},225:e=>{"use strict";e.exports=a},380:e=>{"use strict";e.exports=n},810:e=>{"use strict";e.exports=o},835:e=>{"use strict";e.exports=h}},t={};function f(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,f),i.exports}f.d=(e,t)=>{for(var o in t)f.o(t,o)&&!f.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="";var y={};return f.p=window.jimuConfig.baseUrl,(()=>{"use strict";f.r(y),f.d(y,{default:()=>b});var e=f(810),t=f(254),o=f(591),s=f(37),i=f(225),r=f(380),a=f(820),n=f(282),l=f(903),d=f(836),u=f(632),p=f(440);const c=({longitude:e,latitude:t},o)=>{const s={type:"point",x:e,y:t,spatialReference:{wkid:4326}};return new n.default({geometry:s,symbol:m(o)})},m=e=>({type:"simple-marker",size:"18px",outline:{color:"#fff",width:"3px"},color:e});var h=f(835);const g=({onClick:t,children:o})=>e.React.createElement(h.Button,{type:"primary",size:"lg",style:{width:"100%",background:"#007AC2",maxWidth:"360px"},onClick:t},o);class x extends e.React.PureComponent{constructor(e){super(e),this.handleSubmitSmartRoute=()=>{this.props.onSubmit({searchFor:["testingKits","inPersonTest"],transportMethod:"driving",maxTime:60}),this.props.toggle()},this.state={}}render(){return(0,e.jsx)(h.Modal,{toggle:this.props.toggle,isOpen:this.props.isOpen,centered:!0},(0,e.jsx)(h.ModalHeader,{toggle:this.props.toggle},"SmartRoute"),(0,e.jsx)(h.ModalBody,null,"I'm searching for..."),(0,e.jsx)(h.ModalFooter,null,(0,e.jsx)(g,{onClick:this.handleSubmitSmartRoute},"Create route")))}}class S extends e.React.PureComponent{constructor(e){super(e),this.handleSubmitSmartRoute=()=>{this.props.onSubmit({searchFor:["testingKits","inPersonTest"],transportMethod:"driving",maxTime:60}),this.props.toggle()},this.state={}}render(){return(0,e.jsx)(h.Modal,{toggle:this.props.toggle,isOpen:this.props.isOpen,centered:!0},(0,e.jsx)(h.ModalHeader,{toggle:this.props.toggle},"Facility Status"),(0,e.jsx)(h.ModalBody,null,"I'm searching for..."),(0,e.jsx)(h.ModalFooter,null,(0,e.jsx)(g,{onClick:this.handleSubmitSmartRoute},"Submit Response")))}}var v=function(e,t,o,s){return new(o||(o=Promise))((function(i,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function n(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,n)}l((s=s.apply(e,t||[])).next())}))};class b extends e.React.PureComponent{constructor(e){super(e),this.openSmartRouteModal=()=>{this.setState({showModal:!0})},this.closeSmartRouteModal=()=>{this.setState({showModal:!1})},this.openRespondModal=()=>{this.setState({showResponseModal:!0})},this.closeRespondModal=()=>{this.setState({showResponseModal:!1})},this.handleSubmitSmartRoute=e=>v(this,void 0,void 0,(function*(){console.log({info:e});const t={longitude:-117.182541,latitude:34.055569},o=new n.default({geometry:{type:"point",x:t.longitude,y:t.latitude,spatialReference:{wkid:4326}}}),s=new d.default({apiKey:"",facilities:new l.default({features:[o]}),defaultBreaks:[2.5],travelMode:{type:"automobile"},travelDirection:"to-facility",outSpatialReference:{wkid:3857},trimOuterPolygon:!0}),i=yield u.default.solve("https://route-api.arcgis.com/arcgis/rest/services/World/ServiceAreas/NAServer/ServiceArea_World/solveServiceArea",s);console.log(i),this.closeSmartRouteModal()})),this.state={routeCalculation:"idle",isViewReady:!1,showModal:!1,showResponseModal:!1},this.providerFL=new s.default({title:"SB County Providers",url:this.props.config.providerURL,popupTemplate:{title:"{SiteName}",lastEditInfoEnabled:!1,actions:[{title:"Directions",id:"routeIt"},{title:"Respond",id:"respondIt"}],expressionInfos:[{name:"testingKits",expression:'var sum = $feature.TestsInStockPCR + $feature.TestsInStockRapid;\n                         if (sum <= 50) {\n                           return "red"\n                         } \n                         return "green"\n                        '},{name:"walkingIn",expression:'if ($feature.WalkInsAccepted == "Yes") {\n                           return "green";\n                         } \n                         return "red";\n                        '},{name:"editElapse",expression:'return Round(DateDiff(Now(), Date($feature.LastUpdateDate), "hours"));'}],content:'\n                <p style="margin: auto">{SiteAddress}</p>\n                <p>Last Updated {expression/editElapse} Hours Ago</p>\n                <table>\n                  <tr>\n                    <td><span style="height: 15px; width: 15px; border-radius: 50%; display: inline-block; background-color: {expression/testingKits}"></span></td>\n                    <td><p style="margin: auto; padding-left: 10px">Testing Kits</p></td>\n                  </tr>\n                  <tr>\n                    <td><span style="height: 15px; width: 15px; border-radius: 50%; display: inline-block; background-color: {expression/walkingIn}"></span></td>\n                    <td><p style="margin: auto; padding-left: 10px">Walk-ins Accepted</p></td>\n                  </tr>\n                </table>\n                 '}}),this.map=new t.default({basemap:"arcgis-community",layers:[this.providerFL]})}componentDidMount(){return v(this,void 0,void 0,(function*(){this.view=new o.default({container:"edit-map",map:this.map,zoom:10,center:[-117.182541,34.055569]}),yield this.view.when(),this.setState({isViewReady:!0}),this.view.popup.on("trigger-action",(e=>{"routeIt"===e.action.id&&this.handleRouting(),"respondIt"===e.action.id&&this.submitFeedback()})),new i.default({view:this.view}),this.locator=new r.default({view:this.view,goToLocationEnabled:!1}),this.view.ui.add(this.locator,"top-left")}))}submitFeedback(){this.openRespondModal()}handleRouting(){return v(this,void 0,void 0,(function*(){this.setState({routeCalculation:"calculating"});const e=this.view.popup.selectedFeature,t={coords:{longitude:-117.182541,latitude:34.055569}};if(!t||!e)return void this.setState({routeCalculation:"failed"});const o=e.geometry,s=c(t.coords,"#62C1FB"),i=c(o,"#35AC46"),r=new l.default({features:[s,i]}),d=new p.default({apiKey:"AAPK5fa7b8f95aa1415f9723911fe558ed58ZWTg6Dl5rITcjdMBV8_jqAlm3j4Cyrf_ajSDscpNKxpDMC9KlZULBEtarxeY_qdw",stops:r,outSpatialReference:{wkid:3857},directionsOutputType:"standard",returnDirections:!0});try{const e=(yield a.default.solve("https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",d)).routeResults[0].route;e.symbol={type:"simple-line",width:"7px",color:"#0066FF"};const t=Math.floor(e.geometry.paths[0].length/2),o=e.geometry.paths[0][t];console.log(o);const r={type:"cim",data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10.5,colorLocked:!0,anchorPointUnits:"Relative",frame:{xmin:0,ymin:-5.25,xmax:0,ymax:5.25},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:o[0],y:o[1]},symbol:{type:"CIMTextSymbol",fontFamilyName:"Avenir Next LT Pro Regular",fontStyleName:"normal",height:10.5,horizontalAlignment:"Center",offsetX:0,offsetY:19.5,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]},verticalAlignment:"Center",font:{family:"Avenir Next LT Pro Regular",decoration:"none",style:"normal",weight:"normal"}},textString:`${e.attributes.Total_TravelTime} Minutes`}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",size:39,frame:{xmin:0,ymin:0,xmax:136.5,ymax:39},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,39],[136.5,39],[136.5,0],[0,0],[0,39]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[2,0,28,255]}]}}],scaleSymbolsProportionally:!1,respectFrame:!0,offsetX:0,offsetY:19.5,anchorPoint:{x:0,y:0},rotateClockwise:!1}]}}},l=new n.default({geometry:{type:"point",x:o[0],y:o[1],spatialReference:{wkid:3857}},symbol:r});this.view.graphics.addMany([e,s,i,l]),this.view.goTo(e.geometry.extent),this.setState({routeCalculation:"complete"})}catch(e){console.error(e),this.setState({routeCalculation:"failed"})}}))}componentDidUpdate(e,t){this.props.activeType&&(this.providerFL.definitionExpression=`SiteType = '${this.props.activeType}'`)}render(){return(0,e.jsx)("div",{style:{height:"100%"}},(0,e.jsx)("div",{className:"widget-hack-map",id:"edit-map",style:{height:"100%"}}),(0,e.jsx)("div",{className:"button-container",style:{position:"absolute",bottom:0,width:"100%",textAlign:"center",padding:"0 32px 24px"}},(0,e.jsx)(g,{onClick:this.openSmartRouteModal},"SmartRoute")),(0,e.jsx)(x,{toggle:this.closeSmartRouteModal,isOpen:this.state.showModal,onSubmit:this.handleSubmitSmartRoute}),(0,e.jsx)(S,{toggle:this.closeRespondModal,isOpen:this.state.showResponseModal,onSubmit:this.handleSubmitSmartRoute}))}}b.mapExtraStateProps=e=>{if(e.widgetsState.hack)return{activeType:e.widgetsState.hack.activeType}}})(),y})())}}}));