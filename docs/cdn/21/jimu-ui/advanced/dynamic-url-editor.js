System.register(["jimu-core","jimu-theme","jimu-ui"],(function(e,t){var r={},o={},s={};return{setters:[function(e){r.Immutable=e.Immutable,r.React=e.React,r.ReactRedux=e.ReactRedux,r.UrlInfoPartType=e.UrlInfoPartType,r.classNames=e.classNames,r.css=e.css,r.jsx=e.jsx,r.moduleLoader=e.moduleLoader,r.polished=e.polished,r.queryString=e.queryString,r.utils=e.utils},function(e){o.registerStyles=e.registerStyles,o.withStyles=e.withStyles},function(e){s.Button=e.Button,s.Icon=e.Icon,s.PanelHeader=e.PanelHeader,s.Popper=e.Popper,s.Select=e.Select,s.defaultMessages=e.defaultMessages,s.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier,s.hooks=e.hooks}],execute:function(){e((()=>{var e={2534:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15 3.5v9c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5v-9C1 1.567 4.134 0 8 0s7 1.567 7 3.5zM2 5.304V6.5C2 7.692 4.615 9 8 9s6-1.308 6-2.5V5.304C12.775 6.32 10.546 7 8 7s-4.775-.68-6-1.696zM8 10c2.546 0 4.775-.68 6-1.696V9.5c0 1.192-2.615 2.5-6 2.5s-6-1.308-6-2.5V8.304C3.225 9.32 5.454 10 8 10zm6 1.304C12.775 12.32 10.546 13 8 13s-4.775-.68-6-1.696V12.5C2 13.692 4.615 15 8 15s6-1.308 6-2.5v-1.196zM14 3.5C14 4.692 11.385 6 8 6S2 4.692 2 3.5 4.615 1 8 1s6 1.308 6 2.5z" fill="#000"></path></svg>'},76339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.39 3.425L5.553.588a2.006 2.006 0 00-2.837 0L.588 2.716a2.006 2.006 0 000 2.837L3.425 8.39a2.006 2.006 0 002.837 0l.71-.709 1.347 1.347-.71.71a2.006 2.006 0 000 2.837l2.838 2.837a2.006 2.006 0 002.837 0l2.128-2.128a2.006 2.006 0 000-2.837L12.575 7.61a2.006 2.006 0 00-2.837 0l-.71.709-1.347-1.347.71-.71a2.006 2.006 0 000-2.837zM6.972 6.262l.709-.709a1.003 1.003 0 000-1.419L4.844 1.297a1.003 1.003 0 00-1.419 0L1.297 3.425a1.003 1.003 0 000 1.419L4.134 7.68a1.003 1.003 0 001.419 0l.71-.71-.894-.892a.501.501 0 01.71-.71l.893.893zm2.056 3.476l.6.599a.502.502 0 00.709-.71l-.6-.599.71-.709a1.003 1.003 0 011.419 0l2.837 2.837a1.003 1.003 0 010 1.419l-2.128 2.128a1.003 1.003 0 01-1.419 0L8.32 11.866a1.003 1.003 0 010-1.419l.71-.71z" fill="#000"></path></svg>'},1810:e=>{"use strict";e.exports=r},83016:e=>{"use strict";e.exports=o},21835:e=>{"use strict";e.exports=s}},t={};function a(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var l={};return(()=>{"use strict";a.r(l),a.d(l,{DynamicUrlEditor:()=>w,UrlInfoSelector:()=>u});var e={};a.r(e),a.d(e,{DynamicUrlEditor:()=>o,UrlInfoSelector:()=>s});var t=a(83016),r=a(1810);function o(e){const t=e.theme;return r.css`
    .component-dynamic-url-editor{
      width: 100%;
      height: 100%;
      .ql-container{
        background-color: ${t.colors.palette.light[200]};
      }
      .ql-editor{
        outline: none;
        padding: ${r.polished.rem(5)} ${r.polished.rem(6)};
        p{
          word-break: break-all;
        }
        &:focus {
          border: 1px solid ${t.colors.palette.primary[700]};
        }
      }
      .dynamic-url-editor-btngroup{
        background-color: ${t.colors.palette.light[200]};
      }
    }
  `}function s(e){const t=e.theme;return r.css`
    .component-url-info-selector{
      .param-list{
        height: calc(100% - 45px);
        overflow-y: auto;
        .param-item.param-item-selected{
          border: 1px solid ${t.colors.primary};
        }
        .param-item{
          border: 1px solid transparent;
          cursor: pointer;
          background-color: ${t.colors.palette.light[400]};
          user-select: none;
        }
        .param-item:hover{
          background-color: ${t.colors.palette.light[500]};
        }
        .param-item:active.param-item:hover{
          background-color: ${t.colors.white};
        }
      }
    }
  `}var i=a(21835);const{useSelector:n}=r.ReactRedux,{useState:c}=r.React,d=e=>{const t=[];return Object.keys(e).forEach((r=>{"draft"!==r&&t.push({key:r,value:e[r]})})),t},u=(0,t.withStyles)((e=>{const{editor:t,className:o,selectWidgets:s,selection:a}=e,l=n((e=>(e.appStateInBuilder?e.appStateInBuilder:e).queryObject)),u=e=>{const t=s.findIndex((t=>t.id===e));let o={};if(t>-1){const e=s[t].config.expression;let a="";if(e&&(a=e.replace(/<[^>]+>/g,"")),a&&a.includes("?")){const e=a.substr(a.indexOf("?"));o=r.queryString.parse(e)}}else o=l;return o},[p,m]=c("appURL"),[h,f]=c(d(u(p))),y=i.hooks.useEventCallback((e=>{if(null==a)return;const o=(0,r.Immutable)(e).name;((e,r,o,s)=>{t.deleteText(s.index,s.length),t.insertEmbed(s.index,"urlInfo",{uniqueid:e,name:r,urlInfo:o},"user"),t.setSelection(s.index+1,"user"),t.focus()})(r.utils.getUUID(),o,e,a)}));return r.React.createElement("div",{className:(0,r.classNames)("w-100 h-100",{[o]:!!o})},r.React.createElement("div",{className:"component-url-info-selector w-100 h-100"},r.React.createElement("div",{className:"p-3",style:{display:"none"}},r.React.createElement(i.Select,{size:"sm",value:p,onChange:e=>{const t=e.target.value;m(t),f(d(u(t)))},className:"top-drop"},[{id:"appURL",name:"App Url"}].map((e=>r.React.createElement("option",{key:e.id,value:e.id,title:e.name},e.name))))),r.React.createElement("div",{className:"param-list px-3"},h.map((e=>r.React.createElement("div",{key:e.key,title:e.key,onClick:()=>(e=>{const t=e.key,o={type:r.UrlInfoPartType.Urlinfo,urlsearch:`{${p}.search.${t}}`};y({name:o.urlsearch,parts:[o]})})(e),className:"param-item text-truncate mt-2 p-1"},`${e.key}`))))))}),"UrlInfoSelector");var p=a(76339),m=a.n(p);const h=e=>{const{className:t}=e,o=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(r[o[s]]=e[o[s]])}return r}(e,["className"]),s=(0,r.classNames)("jimu-icon-component",t);return r.React.createElement(i.Icon,Object.assign({className:s,icon:m()},o))};var f=a(2534),y=a.n(f);const x=e=>{const{className:t}=e,o=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(r[o[s]]=e[o[s]])}return r}(e,["className"]),s=(0,r.classNames)("jimu-icon-component",t);return r.React.createElement(i.Icon,Object.assign({className:s,icon:y()},o))};const{useState:g,useRef:b}=r.React,v=[{name:"preventOverflow",options:{altAxis:!0}},(0,i.getFallbackPlacementsModifier)(["left-start","left-end"],!0)],E=[0,8],j=e=>{const{className:t,editorRef:o,useDataSourcesEnabled:s,useDataSources:a,onChange:l,widgetId:n,value:c,selectWidgets:d,RichExpressionBuilder:p,useMixinKeyboardEnterModules:m,useEditorSelectionFormats:f,richTextEditorUtils:y,RichEditorCore:j,Delta:S,ExpressionBuilderType:w}=e,R=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(r[o[s]]=e[o[s]])}return r}(e,["className","editorRef","useDataSourcesEnabled","useDataSources","onChange","widgetId","value","selectWidgets","RichExpressionBuilder","useMixinKeyboardEnterModules","useEditorSelectionFormats","richTextEditorUtils","RichEditorCore","Delta","ExpressionBuilderType"]),[O,k]=g(!1),[M,P]=g(!1),I=b(null),N=b(null),[C,U]=i.hooks.useForwardValueRef(o),B=i.hooks.useTranslate(i.defaultMessages),[T,L]=f(C,!0),[D,F]=g(c),[z,$]=g(!1),q=r.React.useCallback(((e,t)=>{if((e=>{var t;return!!(null===(t=null==e?void 0:e.ops)||void 0===t?void 0:t.length)&&e.ops.some((e=>{var t;const r=null!==(t=null==e?void 0:e.insert)&&void 0!==t?t:{};return r.urlInfo||r.expression||r.urlinfo}))})(t))return t;const r=t.map((e=>"string"==typeof e.insert?e.insert:"")).join("");return(new S).insert(r)}),[S]),K=r.React.useMemo((()=>({toolbar:!1,keyboard:{bindings:{bold:{handler:()=>{}},italic:{handler:()=>{}},underline:{handler:()=>{}},enter:{key:13,handler:()=>{}}}},clipboard:{matchers:[["*",q]]}})),[q]);i.hooks.useUnmount((()=>{l(D)}));const V=a&&a.length>0;return(0,r.jsx)("div",{className:(0,r.classNames)("w-100 h-100",{[t]:!!t})},(0,r.jsx)("div",{className:"component-dynamic-url-editor"},(0,r.jsx)(j,Object.assign({modules:K,className:(0,r.classNames)("rich-text-editor"),onChange:e=>{F(e)},onClick:()=>{z||($(!0),y.setEditorCursorEnd(C))},onBlur:()=>{$(!1),l(D)},editorRef:U,onKeyDown:e=>{e&&e.target&&"Enter"===e.key&&e.target.blur()},defaultValue:c,placeholder:B("websitePlaceholder")},R)),(0,r.jsx)("div",{className:"dynamic-url-editor-btngroup"},(0,r.jsx)(i.Button,{size:"sm",icon:!0,onClick:()=>{k(!O),O&&!M||C.focus(),M&&P(!1)},ref:I,active:O,type:"tertiary",title:B("urlInfo")},(0,r.jsx)(h,null)),s&&(0,r.jsx)(i.Button,{size:"sm",icon:!0,onClick:()=>{P(!M),!O&&M||C.focus(),O&&k(!1)},ref:N,active:M,type:"tertiary",disabled:!V,title:B(V?"data":"dataUnavailableTips")},(0,r.jsx)(x,null))),(0,r.jsx)(i.Popper,{open:O,disableResize:!0,placement:"left-start",reference:I.current,modifiers:v,showArrow:!0,toggle:e=>{(null==C?void 0:C.root.contains(null==e?void 0:e.target))||k((e=>!e))},trapFocus:!1,autoFocus:!1},(0,r.jsx)("div",{style:{width:180,height:300}},(0,r.jsx)(i.PanelHeader,{className:"px-3 py-2",title:B("urlInfo"),onClose:()=>k(!1)}),(0,r.jsx)(u,{editor:C,className:t,selectWidgets:d,selection:L,formats:T}))),(0,r.jsx)(i.Popper,{open:M,disableResize:!0,placement:"left-start",reference:N.current,modifiers:v,showArrow:!0,toggle:e=>{(null==C?void 0:C.root.contains(null==e?void 0:e.target))||P((e=>!e))},offset:E,trapFocus:!1,autoFocus:!1},(0,r.jsx)("div",{css:r.css`
            width: 240px;
            height: 360px;
            .field-list{
              height: calc(100% - 200px) !important;
            }
          `},(0,r.jsx)(i.PanelHeader,{className:"px-3 py-2",title:B("dataPanelTitle"),onClose:()=>P(!1)}),(0,r.jsx)(p,{widgetId:n,source:"user",useDataSources:a,editor:C,formats:T,editable:!1,autoInsertSpace:!1,types:(0,r.Immutable)([w.Attribute]),selection:L})))))};class S extends r.React.PureComponent{constructor(){super(...arguments),this.state={moduleLoaded:!1}}componentDidMount(){Promise.all([r.moduleLoader.loadModule("jimu-ui/advanced/rich-text-editor"),r.moduleLoader.loadModule("jimu-ui/advanced/expression-builder")]).then((e=>{const[{RichExpressionBuilder:t,useEditorSelectionFormats:r,richTextEditorUtils:o,RichEditorCore:s,Delta:a,useMixinKeyboardEnterModules:l},{ExpressionBuilderType:i}]=e;this.state.moduleLoaded||(this.RichExpressionBuilder=t,this.useEditorSelectionFormats=r,this.richTextEditorUtils=o,this.RichEditorCore=s,this.ExpressionBuilderType=i,this.Delta=a,this.useMixinKeyboardEnterModules=l,this.setState({moduleLoaded:!0}))}))}render(){return this.state.moduleLoaded?(0,r.jsx)(j,Object.assign({},this.props,{Delta:this.Delta,useMixinKeyboardEnterModules:this.useMixinKeyboardEnterModules,RichExpressionBuilder:this.RichExpressionBuilder,useEditorSelectionFormats:this.useEditorSelectionFormats,richTextEditorUtils:this.richTextEditorUtils,RichEditorCore:this.RichEditorCore,ExpressionBuilderType:this.ExpressionBuilderType})):null}}const w=(0,t.withStyles)(S,"DynamicUrlEditor");(0,t.registerStyles)("jimu-ui/advanced/dynamic-url-editor",e)})(),l})())}}}));