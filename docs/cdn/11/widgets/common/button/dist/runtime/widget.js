System.register(["jimu-core","jimu-ui"],(function(e,t){var s={},o={};return{setters:[function(e){s.AppMode=e.AppMode,s.BaseVersionManager=e.BaseVersionManager,s.ExpressionPartType=e.ExpressionPartType,s.ExpressionResolverComponent=e.ExpressionResolverComponent,s.ExpressionResolverErrorCode=e.ExpressionResolverErrorCode,s.Immutable=e.Immutable,s.LinkType=e.LinkType,s.React=e.React,s.appActions=e.appActions,s.classNames=e.classNames,s.css=e.css,s.getAppStore=e.getAppStore,s.jsx=e.jsx},function(e){o.Icon=e.Icon,o.Link=e.Link,o.UnitTypes=e.UnitTypes,o.defaultMessages=e.defaultMessages,o.styleUtils=e.styleUtils,o.utils=e.utils}],execute:function(){e((()=>{var e={1810:e=>{"use strict";e.exports=s},21835:e=>{"use strict";e.exports=o}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var n={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(n),i.d(n,{default:()=>u});var e,t=i(1810),s=i(21835);!function(e){e.Left="LEFT",e.Right="RIGHT"}(e||(e={}));class o extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.0.0",description:"The first release.",upgrader:e=>{let t=e;return t.getIn(["styleConfig","name"])&&(t=t.set("styleConfig",t.styleConfig.without("name"))),t.getIn(["styleConfig","customStyle"])&&(t=t.set("styleConfig",t.styleConfig.without("customStyle"))),t.getIn(["styleConfig","themeStyle","quickStyleType"])&&(t=t.setIn(["styleConfig","themeStyle"],{quickStyleType:t.styleConfig.themeStyle.quickStyleType})),t=t.setIn(["styleConfig","useCustom"],!1),t}},{version:"1.1.0",description:"1.1.0",upgrader:e=>{let t=e;return t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","regular","border","width"])&&(t=t.setIn(["styleConfig","customStyle","regular","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","regular","border","width"])))),t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","hover","border","width"])&&(t=t.setIn(["styleConfig","customStyle","hover","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","hover","border","width"])))),t}}]}}const r=new o;function p(e,o,i){const n=e?"default":"hover",r=(0,t.Immutable)(i),p=r.getIn(["components","button","variants",o,n,"color"]),l=r.getIn(["components","button","sizes","default","fontSize"]);return{color:p,size:parseFloat(s.styleUtils.remToPixel(l))}}var l;!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(l||(l={}));class u extends t.React.PureComponent{constructor(o){var i,n,r,u,a;super(o),this.repeat=0,this.getTextFromProps=()=>{var e,t,o,i;return"string"==typeof(null===(t=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.text)?null===(i=null===(o=this.props.config)||void 0===o?void 0:o.functionConfig)||void 0===i?void 0:i.text:this.props.intl.formatMessage({id:"variableButton",defaultMessage:s.defaultMessages.variableButton})},this.setRepeatType=()=>{const e=this.props.repeatedDataSource;let t;t=e?0===e.recordIndex?l.Main:l.Sub:l.None,this.repeat=t},this.getTipExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression&&this.props.config.functionConfig.toolTipExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.toolTip)||""}"`}]})},this.getTextExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.textExpression&&this.props.config.functionConfig.textExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.text)||this.getTextFromProps()}"`}]})},this.getUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onTextExpResolveChange=e=>{if(e.isSuccessful)this.setState({text:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.textExpression&&this.state.textExpression.name),this.setState({text:s})}},this.onTipExpResolveChange=e=>{if(e.isSuccessful)this.setState({toolTip:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.tipExpression&&this.state.tipExpression.name),this.setState({toolTip:s})}},this.onUrlExpResolveChange=e=>{if(e.isSuccessful)this.setState({url:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.urlExpression&&this.state.urlExpression.name),this.setState({url:s})}},this.showQuickStylePanel=()=>{if(!window.jimuConfig.isInBuilder)return!1;const e=this.repeat,{active:t}=this.props;return this.props.showQuickStyle&&t&&e!==l.Sub},this.getWhetherUseQuickStyle=e=>!!(e&&e.styleConfig&&e.styleConfig.themeStyle&&e.styleConfig.themeStyle.quickStyleType),this.getIconStyle=(e,o)=>{const i=e||{},n=o||{};return t.css`
      & img, & svg{
        color: ${i.color};
        fill: ${i.color};
        width: ${i.size}${s.UnitTypes.PIXEL};
        height: ${i.size}${s.UnitTypes.PIXEL};
      }
      &:hover{
        img, svg{
          color: ${n.color};
          fill: ${n.color};
          width: ${n.size}${s.UnitTypes.PIXEL};
          height: ${n.size}${s.UnitTypes.PIXEL};
        }
      }
    `},this.removeUndefinedStyle=e=>{if(!e)return e;const t={};return Object.keys(e).forEach((s=>{("string"==typeof e[s]&&e[s].indexOf("undefined")<0||"number"==typeof e[s])&&(t[s]=e[s])})),t},this.getLinkComponent=()=>{const o=this.props.config,i=o.functionConfig.linkParam,n=this.state.text,r=this.state.toolTip;let p,l;if(o.styleConfig&&o.styleConfig.customStyle){const e=o.styleConfig.customStyle.regular,i=o.styleConfig.customStyle.hover;if(o.styleConfig.useCustom){const o=s.styleUtils.toCSSStyle(e&&e.without("iconProps").asMutable({deep:!0})),n=s.styleUtils.toCSSStyle(i&&i.without("iconProps").asMutable({deep:!0}));if(this.props.active&&this.props.appMode!==t.AppMode.Run){const s=(0,t.getAppStore)().getState().widgetsState[this.props.id]||(0,t.Immutable)({});p={style:s.isConfiguringHover?Object.assign(Object.assign({},this.removeUndefinedStyle(o)),this.removeUndefinedStyle(n)):o,hoverStyle:n},l=this.getIconStyle(s.isConfiguringHover?Object.assign(Object.assign({},null==e?void 0:e.iconProps),null==i?void 0:i.iconProps):null==e?void 0:e.iconProps,null==i?void 0:i.iconProps)}else p={style:o,hoverStyle:n},l=this.getIconStyle(e&&e.iconProps,i&&i.iconProps)}}const u=this.getWhetherUseQuickStyle(o)?{type:o.styleConfig.themeStyle.quickStyleType}:null;let a,c,h;i&&i.linkType&&(c=i.openType,h={linkType:i.linkType},i.linkType===t.LinkType.WebAddress?h.value=this.state.url:(h.value=i.value,a=this.props.queryObject));const g=o.functionConfig.icon,d=this.props.isRTL,f=g&&(!g.position||g.position===e.Left)&&(0,t.jsx)(s.Icon,{icon:g.data,className:(0,t.classNames)({"mr-2 ml-0":!!n&&!d,"ml-2 mr-0":!!n&&d,"mx-0":!n})}),y=g&&g.position&&g.position===e.Right&&(0,t.jsx)(s.Icon,{icon:g.data,className:(0,t.classNames)({"ml-2 mr-0":!!n&&!d,"mr-2 ml-0":!!n&&d,"mx-0":!n})});return(0,t.jsx)(s.Link,{to:h,target:c,queryObject:a,title:r,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",customStyle:p,themeStyle:u,css:l},(0,t.jsx)("span",{className:"text-truncate widget-button-text"},d?y:f,n,d?f:y))},this.onQuickStyleChange=e=>{let{config:t}=this.props;const s=this.props.id,o=this.props.builderSupportModules,i=o&&o.jimuForBuilderLib.getAppConfigAction;i&&(t=t.setIn(["styleConfig","useCustom"],!1),t=t.setIn(["styleConfig","themeStyle","quickStyleType"],e),t=t.setIn(["styleConfig","customStyle","regular"],{iconProps:p(!0,e,this.props.theme)}),t=t.setIn(["styleConfig","customStyle","hover"],{iconProps:p(!1,e,this.props.theme)}),i().editWidgetProperty(s,"config",t).exec())},this.onClick=e=>{e.exbEventType="linkClick"},this.onQuickStyleClose=()=>this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1)),this.getQuickStyleComponent=()=>{var e,s,o,i,n;const r=this.props.builderSupportModules&&this.props.builderSupportModules.widgetModules&&this.props.builderSupportModules.widgetModules.QuickStyle;return r?(0,t.jsx)(r,{onChange:this.onQuickStyleChange,reference:this.domNode&&this.domNode.current,onClose:this.onQuickStyleClose,selectedType:!(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.styleConfig)||void 0===s?void 0:s.useCustom)&&(null===(n=null===(i=null===(o=this.props.config)||void 0===o?void 0:o.styleConfig)||void 0===i?void 0:i.themeStyle)||void 0===n?void 0:n.quickStyleType)}):null},this.state={text:this.getTextFromProps(),toolTip:(null===(n=null===(i=this.props.config)||void 0===i?void 0:i.functionConfig)||void 0===n?void 0:n.toolTip)||"",url:(null===(a=null===(u=null===(r=this.props.config)||void 0===r?void 0:r.functionConfig)||void 0===u?void 0:u.linkParam)||void 0===a?void 0:a.value)||"",textExpression:this.props.useDataSourcesEnabled&&this.getTextExpression(),tipExpression:this.props.useDataSourcesEnabled&&this.getTipExpression(),urlExpression:this.props.useDataSourcesEnabled&&this.getUrlExpression()},this.domNode=t.React.createRef()}componentDidMount(){this.setRepeatType(),this.props.active&&!this.props.hasEverMount&&window.jimuConfig.isInBuilder&&this.props.active&&this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!0)),this.props.hasEverMount||this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"hasEverMount",!0))}componentDidUpdate(e,s){this.props.useDataSourcesEnabled||this.props.config===e.config&&!e.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===e.config&&e.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()}),window.jimuConfig.isInBuilder&&(this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Run||!this.props.active&&e.active)&&this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1))}render(){const e=this.props.useDataSourcesEnabled,s=this.showQuickStylePanel(),o=this.getLinkComponent(),i=this.getQuickStyleComponent();return(0,t.jsx)("div",{className:"jimu-widget widget-button w-100 h-100",css:(this.props.theme,t.css`
    &>a {
      display: flex !important;
      justify-content: center;
    }

    .widget-button-text{
      line-height: initial;
    }

  `),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick},o,s&&i,(0,t.jsx)("div",{style:{display:"none"}},e&&(0,t.jsx)("div",null,(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))))}}u.mapExtraStateProps=(e,s)=>{let o=!1;const i=e.appRuntimeInfo.selection;if(i&&e.appConfig.layouts[i.layoutId]){const t=e.appConfig.layouts[i.layoutId].content[i.layoutItemId];o=t&&t.widgetId===s.id}const n=e.appContext.isInBuilder&&o,r=e.widgetsState[s.id]||(0,t.Immutable)({});return{active:n,showQuickStyle:!!r.showQuickStyle,appMode:n?e.appRuntimeInfo.appMode:null,queryObject:e.queryObject,hasEverMount:r.hasEverMount,isRTL:e.appContext.isRTL}},u.versionManager=r})(),n})())}}}));